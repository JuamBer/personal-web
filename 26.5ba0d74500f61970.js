"use strict";(self.webpackChunkpersonal_web=self.webpackChunkpersonal_web||[]).push([[26],{7026:(Nt,J,s)=>{s.r(J),s.d(J,{CurriculumsModule:()=>Jt});var V=s(529),l=s(4006),j=s(5180),R=s(2694),G=s(5106),H=s(9605),W=s(6333),X=s(8553),K=s(3631),M=s(5593),L=s(585),w=s(4247),k=s(2137),F=s(1493),U=s(2210),Y=s(3388),q=s(7913),_=s(1740),tt=s(3054),et=s(2665),at=s(5722),nt=s(1765),I=s(8783),st=s(2453),y=s(5721),rt=s(4121),f=s(4450),N=s(9300),$=s(2607),h=s(5861),m=s(4188),D=s(2651),it=s(3314),ot=s(660),lt=s(783),d=s(3895);class v extends lt.x{constructor(){super(d.m.upperCamelCase.singular)}static getInstance(){return v.instance||(v.instance=new v),v.instance}}const u=v.getInstance();var ut=s(7379),ct=s(91);const mt={...ut.f},dt=[];class C extends ct.E{constructor(){super(d.m.kebabCase.plural.normal,u,mt,dt)}static getInstance(){return C.instance||(C.instance=new C),C.instance}}const g=C.getInstance();var t=s(4650),A=s(2997),S=s(805),T=s(3416),z=s(3187);let gt=(()=>{class a{constructor(){this.supabase=(0,z.eI)(f.N.apiUrl,f.N.apiKey)}generateCurriculumName(e){return"public/CV_JuanSaezGarcia_"+e.acronym.toUpperCase()+"_"+(new Date).getMonth()+"1_"+(new Date).getFullYear()+"_"+(Math.floor(1e3*Math.random())+1)+".pdf"}uploadCurriculumFile(e,n){var r=this;return(0,h.Z)(function*(){return yield r.supabase.storage.from("curriculums").upload(r.generateCurriculumName(e),n)})()}downloadCurriculumFile(e){var n=this;return(0,h.Z)(function*(){return yield n.supabase.storage.from("curriculums").download(e)})()}}return a.\u0275fac=function(e){return new(e||a)},a.\u0275prov=t.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();var Z=s(6895);const pt=["createImagenesForm"],ft=["updateImagenesForm"];function ht(a,i){1&a&&(t.TgZ(0,"div",15),t._UZ(1,"i",16),t.qZA())}function vt(a,i){if(1&a&&(t.TgZ(0,"small",17),t._uU(1),t.qZA()),2&a){const e=t.oxw();t.xp6(1),t.hij(" ",e.errores.date," ")}}function Ct(a,i){if(1&a&&(t.TgZ(0,"small",17),t._uU(1),t.qZA()),2&a){const e=t.oxw();t.xp6(1),t.hij(" ",e.errores.language," ")}}const B=function(a){return{name:a}};function bt(a,i){if(1&a&&(t._UZ(0,"button",18),t.ALo(1,"translate"),t.ALo(2,"translate")),2&a){const e=t.oxw();t.Q6J("label",t.xi3(1,1,"buttons.create",t.VKq(6,B,t.lcZ(2,4,"tables."+e.names.camelCase.singular+".singular"))))}}function yt(a,i){if(1&a&&(t._UZ(0,"button",18),t.ALo(1,"translate"),t.ALo(2,"translate")),2&a){const e=t.oxw();t.Q6J("label",t.xi3(1,1,"buttons.update",t.VKq(6,B,t.lcZ(2,4,"tables."+e.names.camelCase.singular+".singular"))))}}const At=function(){return{width:"100%",maxWidth:"40rem"}};let O=(()=>{class a{constructor(e,n,r,o,c,b,x,Lt,Ut,Yt){this.formBuilder=e,this.curriculumstore=n,this.languageStore=r,this.toastSrv=o,this.translateSrv=c,this.storageSrv=b,this.config=x,this.route=Lt,this.router=Ut,this.toastUtils=Yt,this.visible=!1,this.curriculum$=this.curriculumstore.select(g.getOne),this.loading$=this.curriculumstore.select(g.getLoading),this.message$=this.curriculumstore.select(g.getMessage).pipe((0,N.h)(p=>!!p)),this.names=d.m,this.languages$=this.languageStore.select(ot.b.getAll),this.languageNames=$.z,this.errores=[],this.subscriptions=[],c.setDefaultLang("es"),this.route.params.subscribe(p=>{if(this.id=Number(p.id),p.modalMode){switch(p.modalMode){case"VIEW":default:this.show(m.g.VIEW);break;case"UPDATE":this.show(m.g.UPDATE);break;case"CREATE":this.show(m.g.CREATE)}"CREATE"!==p.modalMode&&this.curriculumstore.dispatch(u.loadOne({id:Number(p.id)}))}})}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}ngOnInit(){var e=this;this.languageStore.dispatch(it.p.loadAll({payload:null})),this.form=this.formBuilder.group({id:[Date.now()],date:[new Date,[l.kI.required]],language:[void 0,[l.kI.required]],pdf:[void 0]});const n=this.curriculum$.subscribe(o=>{this.patchValue(o)});this.subscriptions.push(n);const r=this.message$.subscribe(function(){var o=(0,h.Z)(function*(c){const b=yield e.toastUtils.messageHandler(e.names.camelCase.singular,D.C.HIDE_MODAL,c);null!==b&&(e.visible=b)});return function(c){return o.apply(this,arguments)}}());this.subscriptions.push(r)}translate(e){this.translateSrv.use(e),this.translateSrv.get("calendar").subscribe(n=>this.config.setTranslation(n))}send(){var e=this;return(0,h.Z)(function*(){if(Object.values(e.form.controls).forEach(c=>{c.markAsDirty()}),e.form.invalid)return;const{data:n,error:r}=yield e.storageSrv.uploadCurriculumFile(e.form.value.language,e.pdf);if(r)throw r;const o=f.N.apiUrl+"/storage/v1/object/public/curriculums/"+n.path;switch(console.log(o),e.modalMode){case m.g.CREATE:e.curriculumstore.dispatch(u.create({payload:{...e.form.value,pdf:o}}));break;case m.g.UPDATE:e.curriculumstore.dispatch(u.update({payload:e.form.value}))}})()}show(e){this.patchValue(null),this.modalMode=e,e==m.g.CREATE&&this.curriculumstore.dispatch(u.unload()),this.visible=!0}upload(e){this.pdf=e.currentFiles[0]}onHide(){this.visible=!1,this.errores=[],this.curriculumstore.dispatch(u.unload()),this.form.reset(),this.createImagenesForm?.reset(),this.updateImagenesForm?.reset(),this.router.navigate(["backoffice",d.m.kebabCase.plural.normal])}patchValue(e){this.form&&this.form.patchValue(e?{id:e.id,language:e.language,pdf:e.pdf,date:e.date}:{id:Date.now(),language:void 0,pdf:void 0,date:new Date})}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(l.qu),t.Y36(A.yh),t.Y36(A.yh),t.Y36(S.ez),t.Y36(T.sK),t.Y36(gt),t.Y36(S.b4),t.Y36(y.gz),t.Y36(y.F0),t.Y36(D.z))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-curriculum-modal"]],viewQuery:function(e,n){if(1&e&&(t.Gf(pt,5),t.Gf(ft,5)),2&e){let r;t.iGM(r=t.CRH())&&(n.createImagenesForm=r.first),t.iGM(r=t.CRH())&&(n.updateImagenesForm=r.first)}},decls:29,vars:32,consts:[[3,"draggable","resizable","modal","maximizable","visible","visibleChange","onHide"],["class","loading-modal p-component-overlay",4,"ngIf"],[3,"header"],[1,"grid","p-fluid"],[1,"col-12","p-3",3,"formGroup","ngSubmit"],[1,"grid"],[1,"xs:col-12","lg:col-6"],[1,"p-float-label"],["formControlName","date","appendTo","body",1,"p-inputtext-sm",3,"showIcon"],["class","p-error",4,"ngIf"],["formControlName","language","optionLabel","name","filterBy","name","appendTo","body",1,"p-inputtext-sm",3,"autoDisplayFirst","options","filter"],[1,"xs:col-12","lg:col-12"],[3,"multiple","onSelect"],[1,"button-container","my-3"],["pButton","","type","submit",3,"label",4,"ngIf"],[1,"loading-modal","p-component-overlay"],[1,"pi","pi-spin","pi-spinner"],[1,"p-error"],["pButton","","type","submit",3,"label"]],template:function(e,n){1&e&&(t.TgZ(0,"p-dialog",0),t.NdJ("visibleChange",function(o){return n.visible=o})("onHide",function(){return n.onHide()}),t.YNc(1,ht,2,0,"div",1),t.ALo(2,"async"),t.TgZ(3,"p-tabView")(4,"p-tabPanel",2),t.ALo(5,"translate"),t.TgZ(6,"div",3)(7,"form",4),t.NdJ("ngSubmit",function(){return n.send()}),t.TgZ(8,"div",5)(9,"div",6)(10,"span",7),t._UZ(11,"p-calendar",8),t.TgZ(12,"label"),t._uU(13),t.ALo(14,"translate"),t.qZA()(),t.YNc(15,vt,2,1,"small",9),t.qZA(),t.TgZ(16,"div",6)(17,"span",7),t._UZ(18,"p-dropdown",10),t.ALo(19,"async"),t.TgZ(20,"label"),t._uU(21),t.ALo(22,"translate"),t.qZA()(),t.YNc(23,Ct,2,1,"small",9),t.qZA(),t.TgZ(24,"div",11)(25,"p-fileUpload",12),t.NdJ("onSelect",function(o){return n.upload(o)}),t.qZA()()(),t.TgZ(26,"div",13),t.YNc(27,bt,3,8,"button",14),t.YNc(28,yt,3,8,"button",14),t.qZA()()()()()()),2&e&&(t.Akn(t.DdM(31,At)),t.Q6J("draggable",!1)("resizable",!1)("modal",!0)("maximizable",!0)("visible",n.visible),t.xp6(1),t.Q6J("ngIf",t.lcZ(2,21,n.loading$)),t.xp6(3),t.s9C("header",t.lcZ(5,23,"tabs.info")),t.xp6(3),t.Q6J("formGroup",n.form),t.xp6(4),t.Q6J("showIcon",!0),t.xp6(2),t.hij("",t.lcZ(14,25,"columns.date")," *"),t.xp6(2),t.Q6J("ngIf",!n.form.controls.date.valid),t.xp6(3),t.Q6J("autoDisplayFirst",!1)("options",t.lcZ(19,27,n.languages$))("filter",!0),t.xp6(3),t.hij("",t.lcZ(22,29,"tables."+n.languageNames.camelCase.singular+".singular")," *"),t.xp6(2),t.Q6J("ngIf",!n.form.controls.language.valid),t.xp6(2),t.Q6J("multiple",!1),t.xp6(2),t.Q6J("ngIf","create"===n.modalMode),t.xp6(1),t.Q6J("ngIf","update"===n.modalMode))},dependencies:[Z.O5,l._Y,l.JJ,l.JL,l.sg,l.u,Y.p,M.Hq,F.V,L.f,U.Lt,I.xf,I.x4,Z.Ov,T.X$]}),a})();var St=s(5482);let E=(()=>{class a{constructor(e,n,r,o,c,b,x){this.store=e,this.confirmationSrv=n,this.messageSrv=r,this.toastSrv=o,this.router=c,this.translateSrv=b,this.publicLanguageStore=x,this.entities$=this.store.select(g.getAll),this.loading$=this.store.select(g.getLoading),this.count$=this.store.select(g.getCount),this.names=d.m,this.requestFilter=f.N.defaultRequestFilter,this.loadTable=!1,this.permisos=[]}ngOnInit(){this.publicLanguageStore.select(rt.$.getOne).pipe((0,N.h)(e=>null!=e)).subscribe(e=>{this.translateSrv.use(e.acronym),this.cargarPagina()}),this.translateSrv.onLangChange.subscribe(e=>{this.cargarPagina()}),this.cargarPagina(),this.getAll()}getAll(){this.cargarPagina(),this.store.dispatch(u.loadAll({payload:this.requestFilter}))}onClick(e){switch(e.type){case"add":this.router.navigate(["backoffice",this.names.kebabCase.plural.normal,{modalMode:"CREATE"}]);break;case"view":this.router.navigate(["backoffice",this.names.kebabCase.plural.normal,{modalMode:"VIEW",id:e.data.id}]);break;case"edit":this.router.navigate(["backoffice",this.names.kebabCase.plural.normal,{modalMode:"UPDATE",id:e.data.id}]);break;case"delete":this.confirmationSrv.confirm({message:this.translateSrv.instant("messages.confirmation.message",{name:this.translateSrv.instant(`tables.${this.names.camelCase.singular}.singular`)}),header:this.translateSrv.instant("messages.confirmation.header"),icon:"pi pi-info-circle",rejectLabel:this.translateSrv.instant("buttons.reject"),acceptLabel:this.translateSrv.instant("buttons.accept"),accept:()=>{this.store.dispatch(u.delete({id:e.data.id}))}})}}cargarPagina(){let e=[],n=[];n.push({action:"add",icon:"pi pi-plus",label:this.translateSrv.instant("buttons.new",{name:this.translateSrv.instant("tables.curriculum.singular")})}),e.push({action:"delete",icon:"pi pi-trash"}),this.tableConfig={fieldConfig:[{field:"date",nombre:this.translateSrv.instant("columns.date"),sort:!1,filter:!1,tipo:"FECHA"},{field:"language",nombre:this.translateSrv.instant(`tables.${$.z.camelCase.singular}.singular`),sort:!1,filter:!1,tipo:"OBJECTO",propiedadParaTipoObjecto:"name"},{field:"pdf",nombre:this.translateSrv.instant("columns.pdf"),sort:!1,filter:!1,tipo:"TEXTO"}],optionButtons:e,topButtons:n}}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(A.yh),t.Y36(S.YP),t.Y36(S.ez),t.Y36(S.ez),t.Y36(y.F0),t.Y36(T.sK),t.Y36(A.yh))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-curriculum"]],viewQuery:function(e,n){if(1&e&&t.Gf(O,5),2&e){let r;t.iGM(r=t.CRH())&&(n.modal=r.first)}},decls:11,vars:15,consts:[[1,"ui-g"],[1,"p-col-12"],[1,"card","card-w-title"],[3,"entities","loading","totalRecords","permisos","tableConfig","requestFilter","requestFilterChange","loadAll","onButtonClick"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),t._uU(4),t.ALo(5,"translate"),t.qZA(),t.TgZ(6,"app-tabla-generica",3),t.NdJ("requestFilterChange",function(o){return n.requestFilter=o})("loadAll",function(){return n.getAll()})("onButtonClick",function(o){return n.onClick(o)}),t.ALo(7,"async"),t.ALo(8,"async"),t.ALo(9,"async"),t.qZA()()()(),t._UZ(10,"app-curriculum-modal")),2&e&&(t.xp6(4),t.hij(" ",t.lcZ(5,7,"tables."+n.names.camelCase.singular+".plural")," "),t.xp6(2),t.Q6J("entities",t.lcZ(7,9,n.entities$))("loading",t.lcZ(8,11,n.loading$))("totalRecords",t.lcZ(9,13,n.count$))("permisos",n.permisos)("tableConfig",n.tableConfig)("requestFilter",n.requestFilter))},dependencies:[St.w,O,Z.Ov,T.X$]}),a})();const Tt=[{path:"",component:E,canActivate:[],pathMatch:"full"},{path:"modal/:modalMode",component:E,canActivate:[]},{path:"modal/:modalMode/:id",component:E,canActivate:[]}];let Zt=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[y.Bz.forChild(Tt),y.Bz]}),a})();var Q=s(8776),Mt=s(2307),Ft=s(62),P=s(4642);let It=(()=>{class a extends Ft.v{constructor(){super((0,z.eI)(f.N.apiUrl,f.N.apiKey),d.m.snakeCase.plural.normal)}getAll(e){var n=this;return(0,h.Z)(function*(){let{data:r,error:o}=yield n.supabase.from(n.table).select('*, "language": "languages" ( * )');return o||(0,P.iP)(r)})()}getOne(e){var n=this;return(0,h.Z)(function*(){let{data:r,error:o}=yield n.supabase.from(n.table).select('*, "language": "languages" ( * )').match({id:e}).single();return o||(0,P.iP)(r)})()}}return a.\u0275fac=function(e){return new(e||a)},a.\u0275prov=t.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})(),Et=(()=>{class a extends Mt.P{constructor(e,n){super(e,u,n),this.actions$=e,this.curriculumSrv=n}}return a.\u0275fac=function(e){return new(e||a)(t.LFG(Q.eX),t.LFG(It))},a.\u0275prov=t.Yz7({token:a,factory:a.\u0275fac}),a})(),xt=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[Z.ez,Q.sQ.forFeature([Et]),A.Aw.forFeature(d.m.kebabCase.plural.normal,g.reducer)]}),a})(),Jt=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[G.S,Zt,V.JF,l.u5,l.UX,j.$,Y.O,st.EV,M.hJ,et.O,F.S,nt.U$,w.d,k.D,K.WN,M.hJ,L._8,F.S,U.kW,_.j,q.Iu,tt.A,I.LU,at.q4,H.y,X.I,xt,R.t,W.D]}),a})()}}]);