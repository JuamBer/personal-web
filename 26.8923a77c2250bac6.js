"use strict";(self.webpackChunkpersonal_web=self.webpackChunkpersonal_web||[]).push([[26],{7026:(B,I,r)=>{r.r(I),r.d(I,{CurriculumsModule:()=>Dt});var f=r(529),d=r(4006),h=r(5180),l=r(2694),w=r(2983),s=r(9605),i=r(6333),g=r(8553),m=r(3631),p=r(5593),v=r(585),k=r(4247),q=r(2137),L=r(1493),$=r(2210),Q=r(3388),_=r(7913),tt=r(1740),et=r(3054),at=r(2665),rt=r(5722),nt=r(1765),P=r(8783),st=r(2453),y=r(550),it=r(4121),M=r(4450),H=r(9300),W=r(2607),Z=r(5861),A=r(4188),V=r(2651),ot=r(3314),lt=r(660),ut=r(783),T=r(3895);class N extends ut.x{constructor(){super(T.m.upperCamelCase.singular)}static getInstance(){return N.instance||(N.instance=new N),N.instance}}const C=N.getInstance();var ct=r(7379),mt=r(91);const dt={...ct.fg},gt=[];class U extends mt.E{constructor(){super(T.m.kebabCase.plural.normal,C,dt,gt)}static getInstance(){return U.instance||(U.instance=new U),U.instance}}const E=U.getInstance();var t=r(4650),D=r(2997),F=r(805),R=r(3416),j=r(3187);let pt=(()=>{class a{constructor(){this.supabase=(0,j.eI)(M.N.apiUrl,M.N.apiKey)}generateCurriculumName(e){return"public/CV_JuanSaezGarcia_"+e.acronym.toUpperCase()+"_"+(new Date).getMonth()+"1_"+(new Date).getFullYear()+"_"+(Math.floor(1e3*Math.random())+1)+".pdf"}uploadCurriculumFile(e,n){var o=this;return(0,Z.Z)(function*(){return yield o.supabase.storage.from("curriculums").upload(o.generateCurriculumName(e),n)})()}downloadCurriculumFile(e){var n=this;return(0,Z.Z)(function*(){return yield n.supabase.storage.from("curriculums").download(e)})()}}return a.\u0275fac=function(e){return new(e||a)},a.\u0275prov=t.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();var Y=r(6895);const ft=["createImagenesForm"],ht=["updateImagenesForm"];function vt(a,u){1&a&&(t.TgZ(0,"div",15),t._UZ(1,"i",16),t.qZA())}function Ct(a,u){if(1&a&&(t.TgZ(0,"small",17),t._uU(1),t.qZA()),2&a){const e=t.oxw();t.xp6(1),t.hij(" ",e.errores.date," ")}}function bt(a,u){if(1&a&&(t.TgZ(0,"small",17),t._uU(1),t.qZA()),2&a){const e=t.oxw();t.xp6(1),t.hij(" ",e.errores.language," ")}}const K=function(a){return{name:a}};function At(a,u){if(1&a&&(t._UZ(0,"button",18),t.ALo(1,"translate"),t.ALo(2,"translate")),2&a){const e=t.oxw();t.Q6J("label",t.xi3(1,1,"buttons.create",t.VKq(6,K,t.lcZ(2,4,"tables."+e.names.camelCase.singular+".singular"))))}}function Tt(a,u){if(1&a&&(t._UZ(0,"button",18),t.ALo(1,"translate"),t.ALo(2,"translate")),2&a){const e=t.oxw();t.Q6J("label",t.xi3(1,1,"buttons.update",t.VKq(6,K,t.lcZ(2,4,"tables."+e.names.camelCase.singular+".singular"))))}}const Et=function(){return{width:"100%",maxWidth:"40rem"}};let X=(()=>{class a{constructor(e,n,o,c,b,O,x,Ft,Rt,Yt){this.formBuilder=e,this.curriculumstore=n,this.languageStore=o,this.toastSrv=c,this.translateSrv=b,this.storageSrv=O,this.config=x,this.route=Ft,this.router=Rt,this.toastUtils=Yt,this.visible=!1,this.curriculum$=this.curriculumstore.select(E.getOne),this.loading$=this.curriculumstore.select(E.getLoading),this.message$=this.curriculumstore.select(E.getMessage).pipe((0,H.h)(S=>!!S)),this.names=T.m,this.languages$=this.languageStore.select(lt.b.getAll),this.languageNames=W.z,this.errores=[],this.subscriptions=[],b.setDefaultLang("es"),this.route.params.subscribe(S=>{if(this.id=Number(S.id),S.modalMode){switch(S.modalMode){case"VIEW":default:this.show(A.g.VIEW);break;case"UPDATE":this.show(A.g.UPDATE);break;case"CREATE":this.show(A.g.CREATE)}"CREATE"!==S.modalMode&&this.curriculumstore.dispatch(C.loadOne({id:Number(S.id)}))}})}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}ngOnInit(){var e=this;this.languageStore.dispatch(ot.p.loadAll({payload:null})),this.form=this.formBuilder.group({id:[Date.now()],date:[new Date,[d.kI.required]],language:[void 0,[d.kI.required]],pdf:[void 0]});const n=this.curriculum$.subscribe(c=>{this.patchValue(c)});this.subscriptions.push(n);const o=this.message$.subscribe(function(){var c=(0,Z.Z)(function*(b){const O=yield e.toastUtils.messageHandler(e.names.camelCase.singular,V.C.HIDE_MODAL,b);null!==O&&(e.visible=O)});return function(b){return c.apply(this,arguments)}}());this.subscriptions.push(o)}translate(e){this.translateSrv.use(e),this.translateSrv.get("calendar").subscribe(n=>this.config.setTranslation(n))}send(){var e=this;return(0,Z.Z)(function*(){if(Object.values(e.form.controls).forEach(b=>{b.markAsDirty()}),e.form.invalid)return;const{data:n,error:o}=yield e.storageSrv.uploadCurriculumFile(e.form.value.language,e.pdf);if(o)throw o;const c=M.N.apiUrl+"/storage/v1/object/public/curriculums/"+n.path;switch(console.log(c),e.modalMode){case A.g.CREATE:e.curriculumstore.dispatch(C.create({payload:{...e.form.value,pdf:c}}));break;case A.g.UPDATE:e.curriculumstore.dispatch(C.update({payload:e.form.value}))}})()}show(e){this.patchValue(null),this.modalMode=e,e==A.g.CREATE&&this.curriculumstore.dispatch(C.unload()),this.visible=!0}upload(e){this.pdf=e.currentFiles[0]}onHide(){this.visible=!1,this.errores=[],this.curriculumstore.dispatch(C.unload()),this.form.reset(),this.createImagenesForm?.reset(),this.updateImagenesForm?.reset(),this.router.navigate(["backoffice",T.m.kebabCase.plural.normal])}patchValue(e){this.form&&this.form.patchValue(e?{id:e.id,language:e.language,pdf:e.pdf,date:e.date}:{id:Date.now(),language:void 0,pdf:void 0,date:new Date})}get ModalMode(){return A.g}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(d.qu),t.Y36(D.yh),t.Y36(D.yh),t.Y36(F.ez),t.Y36(R.sK),t.Y36(pt),t.Y36(F.b4),t.Y36(y.gz),t.Y36(y.F0),t.Y36(V.z))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-curriculum-modal"]],viewQuery:function(e,n){if(1&e&&(t.Gf(ft,5),t.Gf(ht,5)),2&e){let o;t.iGM(o=t.CRH())&&(n.createImagenesForm=o.first),t.iGM(o=t.CRH())&&(n.updateImagenesForm=o.first)}},decls:29,vars:32,consts:[[3,"draggable","resizable","modal","maximizable","visible","visibleChange","onHide"],["class","loading-modal p-component-overlay",4,"ngIf"],[3,"header"],[1,"grid","p-fluid"],[1,"col-12","p-3",3,"formGroup","ngSubmit"],[1,"grid"],[1,"xs:col-12","lg:col-6"],[1,"p-float-label"],["formControlName","date","appendTo","body",1,"p-inputtext-sm",3,"showIcon"],["class","p-error",4,"ngIf"],["formControlName","language","optionLabel","name","filterBy","name","appendTo","body",1,"p-inputtext-sm",3,"autoDisplayFirst","options","filter"],[1,"xs:col-12","lg:col-12"],[3,"multiple","onSelect"],[1,"button-container","my-3"],["pButton","","type","submit",3,"label",4,"ngIf"],[1,"loading-modal","p-component-overlay"],[1,"pi","pi-spin","pi-spinner"],[1,"p-error"],["pButton","","type","submit",3,"label"]],template:function(e,n){1&e&&(t.TgZ(0,"p-dialog",0),t.NdJ("visibleChange",function(c){return n.visible=c})("onHide",function(){return n.onHide()}),t.YNc(1,vt,2,0,"div",1),t.ALo(2,"async"),t.TgZ(3,"p-tabView")(4,"p-tabPanel",2),t.ALo(5,"translate"),t.TgZ(6,"div",3)(7,"form",4),t.NdJ("ngSubmit",function(){return n.send()}),t.TgZ(8,"div",5)(9,"div",6)(10,"span",7),t._UZ(11,"p-calendar",8),t.TgZ(12,"label"),t._uU(13),t.ALo(14,"translate"),t.qZA()(),t.YNc(15,Ct,2,1,"small",9),t.qZA(),t.TgZ(16,"div",6)(17,"span",7),t._UZ(18,"p-dropdown",10),t.ALo(19,"async"),t.TgZ(20,"label"),t._uU(21),t.ALo(22,"translate"),t.qZA()(),t.YNc(23,bt,2,1,"small",9),t.qZA(),t.TgZ(24,"div",11)(25,"p-fileUpload",12),t.NdJ("onSelect",function(c){return n.upload(c)}),t.qZA()()(),t.TgZ(26,"div",13),t.YNc(27,At,3,8,"button",14),t.YNc(28,Tt,3,8,"button",14),t.qZA()()()()()()),2&e&&(t.Akn(t.DdM(31,Et)),t.Q6J("draggable",!1)("resizable",!1)("modal",!0)("maximizable",!0)("visible",n.visible),t.xp6(1),t.Q6J("ngIf",t.lcZ(2,21,n.loading$)),t.xp6(3),t.s9C("header",t.lcZ(5,23,"tabs.info")),t.xp6(3),t.Q6J("formGroup",n.form),t.xp6(4),t.Q6J("showIcon",!0),t.xp6(2),t.hij("",t.lcZ(14,25,"columns.date")," *"),t.xp6(2),t.Q6J("ngIf",!n.form.controls.date.valid),t.xp6(3),t.Q6J("autoDisplayFirst",!1)("options",t.lcZ(19,27,n.languages$))("filter",!0),t.xp6(3),t.hij("",t.lcZ(22,29,"tables."+n.languageNames.camelCase.singular+".singular")," *"),t.xp6(2),t.Q6J("ngIf",!n.form.controls.language.valid),t.xp6(2),t.Q6J("multiple",!1),t.xp6(2),t.Q6J("ngIf",n.modalMode===n.ModalMode.CREATE),t.xp6(1),t.Q6J("ngIf",n.modalMode===n.ModalMode.UPDATE))},dependencies:[Y.O5,d._Y,d.JJ,d.JL,d.sg,d.u,Q.p,p.Hq,L.V,v.f,$.Lt,P.xf,P.x4,Y.Ov,R.X$]}),a})();var St=r(5482);let J=(()=>{class a{constructor(e,n,o,c,b,O,x){this.store=e,this.confirmationSrv=n,this.messageSrv=o,this.toastSrv=c,this.router=b,this.translateSrv=O,this.publicLanguageStore=x,this.entities$=this.store.select(E.getAll),this.loading$=this.store.select(E.getLoading),this.count$=this.store.select(E.getCount),this.names=T.m,this.requestFilter=M.N.defaultRequestFilter,this.loadTable=!1,this.permisos=[]}ngOnInit(){this.publicLanguageStore.select(it.$.getOne).pipe((0,H.h)(e=>null!=e)).subscribe(e=>{this.translateSrv.use(e.acronym),this.cargarPagina()}),this.translateSrv.onLangChange.subscribe(e=>{this.cargarPagina()}),this.cargarPagina(),this.getAll()}getAll(){this.cargarPagina(),this.store.dispatch(C.loadAll({payload:this.requestFilter}))}onClick(e){switch(e.type){case"add":this.router.navigate(["backoffice",this.names.kebabCase.plural.normal,{modalMode:"CREATE"}]);break;case"view":this.router.navigate(["backoffice",this.names.kebabCase.plural.normal,{modalMode:"VIEW",id:e.data.id}]);break;case"edit":this.router.navigate(["backoffice",this.names.kebabCase.plural.normal,{modalMode:"UPDATE",id:e.data.id}]);break;case"delete":this.confirmationSrv.confirm({message:this.translateSrv.instant("messages.confirmation.message",{name:this.translateSrv.instant(`tables.${this.names.camelCase.singular}.singular`)}),header:this.translateSrv.instant("messages.confirmation.header"),icon:"pi pi-info-circle",rejectLabel:this.translateSrv.instant("buttons.reject"),acceptLabel:this.translateSrv.instant("buttons.accept"),accept:()=>{this.store.dispatch(C.delete({id:e.data.id}))}})}}cargarPagina(){let e=[],n=[];n.push({action:"add",icon:"pi pi-plus",label:this.translateSrv.instant("buttons.new",{name:this.translateSrv.instant("tables.curriculum.singular")})}),e.push({action:"delete",icon:"pi pi-trash"}),this.tableConfig={fieldConfig:[{field:"date",nombre:this.translateSrv.instant("columns.date"),sort:!1,filter:!1,tipo:"FECHA"},{field:"language",nombre:this.translateSrv.instant(`tables.${W.z.camelCase.singular}.singular`),sort:!1,filter:!1,tipo:"OBJECTO",propiedadParaTipoObjecto:"name"},{field:"pdf",nombre:this.translateSrv.instant("columns.pdf"),sort:!1,filter:!1,tipo:"TEXTO"}],optionButtons:e,topButtons:n}}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(D.yh),t.Y36(F.YP),t.Y36(F.ez),t.Y36(F.ez),t.Y36(y.F0),t.Y36(R.sK),t.Y36(D.yh))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-curriculum"]],viewQuery:function(e,n){if(1&e&&t.Gf(X,5),2&e){let o;t.iGM(o=t.CRH())&&(n.modal=o.first)}},decls:11,vars:15,consts:[[1,"ui-g"],[1,"p-col-12"],[1,"card","card-w-title"],[3,"entities","loading","totalRecords","permisos","tableConfig","requestFilter","requestFilterChange","loadAll","onButtonClick"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),t._uU(4),t.ALo(5,"translate"),t.qZA(),t.TgZ(6,"app-tabla-generica",3),t.NdJ("requestFilterChange",function(c){return n.requestFilter=c})("loadAll",function(){return n.getAll()})("onButtonClick",function(c){return n.onClick(c)}),t.ALo(7,"async"),t.ALo(8,"async"),t.ALo(9,"async"),t.qZA()()()(),t._UZ(10,"app-curriculum-modal")),2&e&&(t.xp6(4),t.hij(" ",t.lcZ(5,7,"tables."+n.names.camelCase.singular+".plural")," "),t.xp6(2),t.Q6J("entities",t.lcZ(7,9,n.entities$))("loading",t.lcZ(8,11,n.loading$))("totalRecords",t.lcZ(9,13,n.count$))("permisos",n.permisos)("tableConfig",n.tableConfig)("requestFilter",n.requestFilter))},dependencies:[St.w,X,Y.Ov,R.X$]}),a})();const It=[{path:"",component:J,canActivate:[],pathMatch:"full"},{path:"modal/:modalMode",component:J,canActivate:[]},{path:"modal/:modalMode/:id",component:J,canActivate:[]}];let Mt=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[y.Bz.forChild(It),y.Bz]}),a})();var G=r(8776),Zt=r(2307),Nt=r(62),z=r(4642);let Ut=(()=>{class a extends Nt.v{constructor(){super((0,j.eI)(M.N.apiUrl,M.N.apiKey),T.m.snakeCase.plural.normal)}getAll(e){var n=this;return(0,Z.Z)(function*(){let{data:o,error:c}=yield n.supabase.from(n.table).select('*, "language": "languages" ( * )');return c||(0,z.iP)(o)})()}getOne(e){var n=this;return(0,Z.Z)(function*(){let{data:o,error:c}=yield n.supabase.from(n.table).select('*, "language": "languages" ( * )').match({id:e}).single();return c||(0,z.iP)(o)})()}}return a.\u0275fac=function(e){return new(e||a)},a.\u0275prov=t.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})(),Ot=(()=>{class a extends Zt.P{constructor(e,n){super(e,C,n),this.actions$=e,this.curriculumSrv=n}}return a.\u0275fac=function(e){return new(e||a)(t.LFG(G.eX),t.LFG(Ut))},a.\u0275prov=t.Yz7({token:a,factory:a.\u0275fac}),a})(),yt=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[Y.ez,G.sQ.forFeature([Ot]),D.Aw.forFeature(T.m.kebabCase.plural.normal,E.reducer)]}),a})(),Dt=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[w.S,Mt,f.JF,d.u5,d.UX,h.$,Q.O,st.EV,p.hJ,at.O,L.S,nt.U$,k.d,q.D,m.WN,p.hJ,v._8,L.S,$.kW,tt.j,_.Iu,et.A,P.LU,rt.q4,s.y,g.I,yt,l.t,i.D]}),a})()},8426:(B,I,r)=>{r.d(I,{E7:()=>f,rE:()=>h,vA:()=>d});var f=(()=>{return(l=f||(f={})).TEXT="TEXT",l.NUMBER="NUMBER",l.DATE="DATE",l.TIME="TIME",l.DATETIME="DATETIME",l.CURRENCY="CURRENCY",l.OBJECT="OBJECT",l.ARRAY="ARRAY",l.BOOLEAN="BOOLEAN",l.IMAGE="IMAGE",f;var l})(),d=(()=>{return(l=d||(d={})).START_WITH="START_WITH",l.ENDS_WITH="ENDS_WITH",l.CONTAINS="CONTAINS",l.NOT_CONTAINS="NOT_CONTAINS",l.EQUAL="EQUAL",l.NOT_EQUAL="NOT_EQUAL",d;var l})(),h=(()=>{return(l=h||(h={})).CREATE="CREATE",l.UPDATE="UPDATE",l.DELETE="DELETE",l.VIEW="VIEW",l.DUPLICATE="DUPLICATE",h;var l})()},62:(B,I,r)=>{r.d(I,{v:()=>l});var f=r(5861),d=r(8426),h=r(4642);class l{constructor(s,i,g="*",m="*",p="name"){this.supabase=s,this.table=i,this.getAllSelection=g,this.getOneSelection=m,this.titleSelection=p}getAll(s){var i=this;return(0,f.Z)(function*(){let g=i.supabase.from(i.table).select(i.getAllSelection);s&&"sortField"in s&&l.applyFiltersAndSorting(g,s);const{data:m,error:p}=yield g;return p||(0,h.iP)(m)})()}getTitle(s){var i=this;return(0,f.Z)(function*(){const{data:g,error:m}=yield i.supabase.from(i.table).select(i.titleSelection).match({id:s}).single();return m||(0,h.iP)(g)})()}getOne(s){var i=this;return(0,f.Z)(function*(){const{data:g,error:m}=yield i.supabase.from(i.table).select(i.getOneSelection).match({id:s}).single();return m||(0,h.iP)(g)})()}create(s){var i=this;return(0,f.Z)(function*(){const{data:g,error:m}=yield i.supabase.from(i.table).insert([(0,h.PI)((0,h.KU)(s))]);return m||g})()}update(s){var i=this;return(0,f.Z)(function*(){const{data:g,error:m}=yield i.supabase.from(i.table).update((0,h.PI)((0,h.KU)(s))).match({id:s.id});return m||g})()}delete(s){var i=this;return(0,f.Z)(function*(){const{data:g,error:m}=yield i.supabase.from(i.table).delete().match({id:s});return m||g})()}count(){var s=this;return(0,f.Z)(function*(){const{count:i,error:g}=yield s.supabase.from(s.table).select("*",{count:"exact",head:!0});return g||i})()}static applyFiltersAndSorting(s,i){i.sortField&&i.sortOrder&&(s=s.order(i.sortField,{ascending:1===i.sortOrder})),i.filters&&Object.entries(i.filters).forEach(([g,m])=>{const p=g,v=m.value.value;if(v)switch(m.value.filterType){case d.vA.START_WITH:s=s.ilike(p,`${v}%`);break;case d.vA.ENDS_WITH:s=s.ilike(p,`%${v}`);break;case d.vA.EQUAL:s=s.eq(p,v);break;case d.vA.NOT_EQUAL:s=s.not(p,"eq",v);break;case d.vA.CONTAINS:s=s.ilike(p,`%${v}%`);break;case d.vA.NOT_CONTAINS:s=s.not(p,"like",`%${v}%`);break;default:s=s.ilike(p,`%${v}%`)}}),Number.isInteger(i.first)&&Number.isInteger(i.rows)&&(s=s.range(i.first,i.first+i.rows-1))}}}}]);