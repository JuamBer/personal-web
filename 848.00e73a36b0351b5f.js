"use strict";(self.webpackChunkpersonal_web=self.webpackChunkpersonal_web||[]).push([[848],{6171:(J,T,n)=>{n.r(T),n.d(T,{CompaniesModule:()=>gt});var h=n(529),l=n(4006),g=n(5180),r=n(2694),V=n(2983),s=n(9605),i=n(6333),c=n(8553),m=n(3631),u=n(5593),v=n(585),j=n(4247),K=n(2137),O=n(1493),X=n(2210),G=n(7913),Y=n(1740),P=n(3054),k=n(2665),z=n(5722),w=n(1765),U=n(8783),_=n(2453),I=n(550),D=n(7618),q=n(4121),tt=n(4450),Q=n(9300),et=n(5861),C=n(4188),$=n(2651),b=n(2616),W=n(8217),E=n(609),t=n(4650),R=n(2997),M=n(805),Z=n(3416),N=n(6895);const nt=["createImagenesForm"],at=["updateImagenesForm"];function ot(a,d){1&a&&(t.TgZ(0,"div",15),t._UZ(1,"i",16),t.qZA())}function st(a,d){if(1&a&&(t.TgZ(0,"small",17),t._uU(1),t.qZA()),2&a){const e=t.oxw();t.xp6(1),t.hij(" ",e.errores.name," ")}}function it(a,d){if(1&a&&(t.TgZ(0,"small",17),t._uU(1),t.qZA()),2&a){const e=t.oxw();t.xp6(1),t.hij(" ",e.errores.location," ")}}function rt(a,d){if(1&a&&(t.TgZ(0,"small",17),t._uU(1),t.qZA()),2&a){const e=t.oxw();t.xp6(1),t.hij(" ",e.errores.description," ")}}const F=function(a){return{name:a}};function lt(a,d){if(1&a&&(t._UZ(0,"button",18),t.ALo(1,"translate"),t.ALo(2,"translate")),2&a){const e=t.oxw();t.Q6J("label",t.xi3(1,1,"buttons.create",t.VKq(6,F,t.lcZ(2,4,"tables."+e.names.camelCase.singular+".singular"))))}}function mt(a,d){if(1&a&&(t._UZ(0,"button",18),t.ALo(1,"translate"),t.ALo(2,"translate")),2&a){const e=t.oxw();t.Q6J("label",t.xi3(1,1,"buttons.update",t.VKq(6,F,t.lcZ(2,4,"tables."+e.names.camelCase.singular+".singular"))))}}const ct=function(){return{width:"100%",maxWidth:"40rem"}},x=function(a,d){return{"ng-invalid":a,"ng-dirty":d}};let H=(()=>{class a{constructor(e,o,p,f,S,y,B,ft){this.formBuilder=e,this.companyStore=o,this.toastSrv=p,this.translateSrv=f,this.config=S,this.route=y,this.router=B,this.toastUtils=ft,this.visible=!1,this.company$=this.companyStore.select(E.K.getOne),this.loading$=this.companyStore.select(E.K.getLoading),this.message$=this.companyStore.select(E.K.getMessage).pipe((0,Q.h)(A=>!!A)),this.names=W.t,this.errores=[],this.subscriptions=[],f.setDefaultLang("es"),this.route.params.subscribe(A=>{if(this.id=Number(A.id),A.modalMode){switch(A.modalMode){case"VIEW":default:this.show(C.g.VIEW);break;case"UPDATE":this.show(C.g.UPDATE);break;case"CREATE":this.show(C.g.CREATE)}"CREATE"!==A.modalMode&&this.companyStore.dispatch(b._.loadOne({id:Number(A.id)}))}})}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}ngOnInit(){var e=this;this.translate("es"),this.form=this.formBuilder.group({id:[Date.now()],name:[void 0,[l.kI.required]],description:[void 0,[l.kI.required]],location:[void 0,[l.kI.required]]});const o=this.company$.subscribe(f=>{this.patchValue(f)});this.subscriptions.push(o);const p=this.message$.subscribe(function(){var f=(0,et.Z)(function*(S){const y=yield e.toastUtils.messageHandler(e.names.camelCase.singular,$.C.HIDE_MODAL,S);null!==y&&(e.visible=y)});return function(S){return f.apply(this,arguments)}}());this.subscriptions.push(p)}translate(e){this.translateSrv.use(e),this.translateSrv.get("calendar").subscribe(o=>this.config.setTranslation(o))}send(){if(Object.values(this.form.controls).forEach(e=>{e.markAsDirty()}),!this.form.invalid)switch(this.modalMode){case C.g.CREATE:this.companyStore.dispatch(b._.create({payload:this.form.value}));break;case C.g.UPDATE:this.companyStore.dispatch(b._.update({payload:this.form.value}))}}show(e){this.patchValue(null),this.modalMode=e,this.form.enable(),e==C.g.CREATE&&this.companyStore.dispatch(b._.unload()),e==C.g.VIEW&&this.form.disable(),this.visible=!0}onHide(){this.visible=!1,this.errores=[],this.companyStore.dispatch(b._.unload()),this.form.reset(),this.createImagenesForm?.reset(),this.updateImagenesForm?.reset(),this.router.navigate(["backoffice","companies"])}patchValue(e){this.form&&this.form.patchValue(e?{id:e.id,name:e.name,description:e.description,location:e.location}:{id:Date.now(),name:void 0,description:void 0,location:void 0})}get ModalMode(){return C.g}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(l.qu),t.Y36(R.yh),t.Y36(M.ez),t.Y36(Z.sK),t.Y36(M.b4),t.Y36(I.gz),t.Y36(I.F0),t.Y36($.z))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-company-modal"]],viewQuery:function(e,o){if(1&e&&(t.Gf(nt,5),t.Gf(at,5)),2&e){let p;t.iGM(p=t.CRH())&&(o.createImagenesForm=p.first),t.iGM(p=t.CRH())&&(o.updateImagenesForm=p.first)}},decls:33,vars:41,consts:[[3,"draggable","resizable","modal","maximizable","visible","visibleChange","onHide"],["class","loading-modal p-component-overlay",4,"ngIf"],[3,"header"],[1,"grid","p-fluid"],[1,"col-12","p-3",3,"formGroup","ngSubmit"],[1,"grid"],[1,"xs:col-12","lg:col-6"],[1,"p-float-label"],["type","text","formControlName","name","pInputText","",1,"p-inputtext-sm",3,"ngClass"],["class","p-error",4,"ngIf"],["type","text","formControlName","location","pInputText","",1,"p-inputtext-sm",3,"ngClass"],[1,"xs:col-12","lg:col-12"],["formControlName","description","pInputTextarea","",1,"p-inputtext-sm",3,"ngClass"],[1,"button-container","my-3"],["pButton","","type","submit",3,"label",4,"ngIf"],[1,"loading-modal","p-component-overlay"],[1,"pi","pi-spin","pi-spinner"],[1,"p-error"],["pButton","","type","submit",3,"label"]],template:function(e,o){1&e&&(t.TgZ(0,"p-dialog",0),t.NdJ("visibleChange",function(f){return o.visible=f})("onHide",function(){return o.onHide()}),t.YNc(1,ot,2,0,"div",1),t.ALo(2,"async"),t.TgZ(3,"p-tabView")(4,"p-tabPanel",2),t.ALo(5,"translate"),t.TgZ(6,"div",3)(7,"form",4),t.NdJ("ngSubmit",function(){return o.send()}),t.TgZ(8,"div",5)(9,"div",6)(10,"span",7),t._UZ(11,"input",8),t.TgZ(12,"label"),t._uU(13),t.ALo(14,"translate"),t.qZA()(),t.YNc(15,st,2,1,"small",9),t.qZA(),t.TgZ(16,"div",6)(17,"span",7),t._UZ(18,"input",10),t.TgZ(19,"label"),t._uU(20),t.ALo(21,"translate"),t.qZA()(),t.YNc(22,it,2,1,"small",9),t.qZA(),t.TgZ(23,"div",11)(24,"span",7),t._UZ(25,"textarea",12),t.TgZ(26,"label"),t._uU(27),t.ALo(28,"translate"),t.qZA()(),t.YNc(29,rt,2,1,"small",9),t.qZA()(),t.TgZ(30,"div",13),t.YNc(31,lt,3,8,"button",14),t.YNc(32,mt,3,8,"button",14),t.qZA()()()()()()),2&e&&(t.Akn(t.DdM(31,ct)),t.Q6J("draggable",!1)("resizable",!1)("modal",!0)("maximizable",!0)("visible",o.visible),t.xp6(1),t.Q6J("ngIf",t.lcZ(2,21,o.loading$)),t.xp6(3),t.s9C("header",t.lcZ(5,23,"tabs.info")),t.xp6(3),t.Q6J("formGroup",o.form),t.xp6(4),t.Q6J("ngClass",t.WLB(32,x,o.form.controls.name.invalid,o.form.controls.name.dirty)),t.xp6(2),t.hij("",t.lcZ(14,25,"columns.name")," *"),t.xp6(2),t.Q6J("ngIf",!o.form.controls.name.valid),t.xp6(3),t.Q6J("ngClass",t.WLB(35,x,o.form.controls.location.invalid,o.form.controls.location.dirty)),t.xp6(2),t.hij("",t.lcZ(21,27,"columns.location")," *"),t.xp6(2),t.Q6J("ngIf",!o.form.controls.location.valid),t.xp6(3),t.Q6J("ngClass",t.WLB(38,x,o.form.controls.description.invalid,o.form.controls.description.dirty)),t.xp6(2),t.hij("",t.lcZ(28,29,"columns.description")," *"),t.xp6(2),t.Q6J("ngIf",!o.form.controls.description.valid),t.xp6(2),t.Q6J("ngIf",o.modalMode===o.ModalMode.CREATE),t.xp6(1),t.Q6J("ngIf",o.modalMode===o.ModalMode.UPDATE))},dependencies:[N.mk,N.O5,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u,u.Hq,O.V,Y.o,P.g,U.xf,U.x4,N.Ov,Z.X$]}),a})();var dt=n(5482);let L=(()=>{class a{constructor(e,o,p,f,S,y,B){this.store=e,this.confirmationSrv=o,this.messageSrv=p,this.toastSrv=f,this.router=S,this.translateSrv=y,this.publicLanguageStore=B,this.entities$=this.store.select(E.K.getAll),this.loading$=this.store.select(E.K.getLoading),this.count$=this.store.select(E.K.getCount),this.names=W.t,this.requestFilter=tt.N.defaultRequestFilter,this.loadTable=!1,this.permisos=[]}ngOnInit(){this.publicLanguageStore.select(q.$.getOne).pipe((0,Q.h)(e=>null!=e)).subscribe(e=>{this.translateSrv.use(e.acronym)}),this.translateSrv.onLangChange.subscribe(e=>{this.cargarPagina()}),this.cargarPagina(),this.getAll()}getAll(){this.cargarPagina(),this.store.dispatch(b._.loadAll({payload:this.requestFilter}))}onClick(e){switch(e.type){case"add":this.router.navigate(["backoffice",this.names.camelCase.plural,{modalMode:"CREATE"}]);break;case"view":this.router.navigate(["backoffice",this.names.camelCase.plural,{modalMode:"VIEW",id:e.data.id}]);break;case"edit":this.router.navigate(["backoffice",this.names.camelCase.plural,{modalMode:"UPDATE",id:e.data.id}]);break;case"delete":this.confirmationSrv.confirm({message:this.translateSrv.instant("messages.confirmation.message",{name:this.translateSrv.instant(`tables.${this.names.camelCase.singular}.singular`)}),header:this.translateSrv.instant("messages.confirmation.header"),icon:"pi pi-info-circle",rejectLabel:this.translateSrv.instant("buttons.reject"),acceptLabel:this.translateSrv.instant("buttons.accept"),accept:()=>{this.store.dispatch(b._.delete({id:e.data.id}))}})}}cargarPagina(){let e=[],o=[];o.push({action:"add",icon:"pi pi-plus",label:this.translateSrv.instant("buttons.new",{name:this.translateSrv.instant(`tables.${this.names.camelCase.singular}.singular`)})}),e.push({action:"view",icon:"pi pi-search-plus"}),e.push({action:"edit",icon:"pi pi-pencil"}),e.push({action:"delete",icon:"pi pi-trash"}),this.tableConfig={fieldConfig:[{field:"name",nombre:this.translateSrv.instant("columns.name"),sort:!1,filter:!1,tipo:"TEXTO"},{field:"description",nombre:this.translateSrv.instant("columns.description"),sort:!1,filter:!1,tipo:"TEXTO"},{field:"location",nombre:this.translateSrv.instant("columns.location"),sort:!1,filter:!1,tipo:"TEXTO"}],optionButtons:e,topButtons:o}}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(R.yh),t.Y36(M.YP),t.Y36(M.ez),t.Y36(M.ez),t.Y36(I.F0),t.Y36(Z.sK),t.Y36(R.yh))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-company"]],viewQuery:function(e,o){if(1&e&&t.Gf(H,5),2&e){let p;t.iGM(p=t.CRH())&&(o.modal=p.first)}},decls:11,vars:15,consts:[[1,"ui-g"],[1,"p-col-12"],[1,"card","card-w-title"],[3,"entities","loading","totalRecords","permisos","tableConfig","requestFilter","requestFilterChange","loadAll","onButtonClick"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),t._uU(4),t.ALo(5,"translate"),t.qZA(),t.TgZ(6,"app-tabla-generica",3),t.NdJ("requestFilterChange",function(f){return o.requestFilter=f})("loadAll",function(){return o.getAll()})("onButtonClick",function(f){return o.onClick(f)}),t.ALo(7,"async"),t.ALo(8,"async"),t.ALo(9,"async"),t.qZA()()()(),t._UZ(10,"app-company-modal")),2&e&&(t.xp6(4),t.hij(" ",t.lcZ(5,7,"tables."+o.names.camelCase.singular+".plural")," "),t.xp6(2),t.Q6J("entities",t.lcZ(7,9,o.entities$))("loading",t.lcZ(8,11,o.loading$))("totalRecords",t.lcZ(9,13,o.count$))("permisos",o.permisos)("tableConfig",o.tableConfig)("requestFilter",o.requestFilter))},dependencies:[dt.w,H,N.Ov,Z.X$]}),a})();const pt=[{path:"",component:L,canActivate:[D.a],pathMatch:"full"},{path:"modal/:modalMode",component:L,canActivate:[D.a]},{path:"modal/:modalMode/:id",component:L,canActivate:[D.a]}];let ut=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[I.Bz.forChild(pt),I.Bz]}),a})();var ht=n(5636);let gt=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[V.S,ut,h.JF,l.u5,l.UX,g.$,_.EV,u.hJ,k.O,O.S,w.U$,j.d,K.D,m.WN,u.hJ,v._8,O.S,X.kW,Y.j,G.Iu,P.A,U.LU,z.q4,s.y,c.I,ht.h,r.t,i.D]}),a})()},8426:(J,T,n)=>{n.d(T,{E7:()=>h,rE:()=>g,vA:()=>l});var h=(()=>{return(r=h||(h={})).TEXT="TEXT",r.NUMBER="NUMBER",r.DATE="DATE",r.TIME="TIME",r.DATETIME="DATETIME",r.CURRENCY="CURRENCY",r.OBJECT="OBJECT",r.ARRAY="ARRAY",r.BOOLEAN="BOOLEAN",r.IMAGE="IMAGE",h;var r})(),l=(()=>{return(r=l||(l={})).START_WITH="START_WITH",r.ENDS_WITH="ENDS_WITH",r.CONTAINS="CONTAINS",r.NOT_CONTAINS="NOT_CONTAINS",r.EQUAL="EQUAL",r.NOT_EQUAL="NOT_EQUAL",l;var r})(),g=(()=>{return(r=g||(g={})).CREATE="CREATE",r.UPDATE="UPDATE",r.DELETE="DELETE",r.VIEW="VIEW",r.DUPLICATE="DUPLICATE",g;var r})()},62:(J,T,n)=>{n.d(T,{v:()=>r});var h=n(5861),l=n(8426),g=n(4642);class r{constructor(s,i,c="*",m="*",u="name"){this.supabase=s,this.table=i,this.getAllSelection=c,this.getOneSelection=m,this.titleSelection=u}getAll(s){var i=this;return(0,h.Z)(function*(){let c=i.supabase.from(i.table).select(i.getAllSelection);s&&"sortField"in s&&r.applyFiltersAndSorting(c,s);const{data:m,error:u}=yield c;return u||(0,g.iP)(m)})()}getTitle(s){var i=this;return(0,h.Z)(function*(){const{data:c,error:m}=yield i.supabase.from(i.table).select(i.titleSelection).match({id:s}).single();return m||(0,g.iP)(c)})()}getOne(s){var i=this;return(0,h.Z)(function*(){const{data:c,error:m}=yield i.supabase.from(i.table).select(i.getOneSelection).match({id:s}).single();return m||(0,g.iP)(c)})()}create(s){var i=this;return(0,h.Z)(function*(){const{data:c,error:m}=yield i.supabase.from(i.table).insert([(0,g.PI)((0,g.KU)(s))]);return m||c})()}update(s){var i=this;return(0,h.Z)(function*(){const{data:c,error:m}=yield i.supabase.from(i.table).update((0,g.PI)((0,g.KU)(s))).match({id:s.id});return m||c})()}delete(s){var i=this;return(0,h.Z)(function*(){const{data:c,error:m}=yield i.supabase.from(i.table).delete().match({id:s});return m||c})()}count(){var s=this;return(0,h.Z)(function*(){const{count:i,error:c}=yield s.supabase.from(s.table).select("*",{count:"exact",head:!0});return c||i})()}static applyFiltersAndSorting(s,i){i.sortField&&i.sortOrder&&(s=s.order(i.sortField,{ascending:1===i.sortOrder})),i.filters&&Object.entries(i.filters).forEach(([c,m])=>{const u=c,v=m.value.value;if(v)switch(m.value.filterType){case l.vA.START_WITH:s=s.ilike(u,`${v}%`);break;case l.vA.ENDS_WITH:s=s.ilike(u,`%${v}`);break;case l.vA.EQUAL:s=s.eq(u,v);break;case l.vA.NOT_EQUAL:s=s.not(u,"eq",v);break;case l.vA.CONTAINS:s=s.ilike(u,`%${v}%`);break;case l.vA.NOT_CONTAINS:s=s.not(u,"like",`%${v}%`);break;default:s=s.ilike(u,`%${v}%`)}}),Number.isInteger(i.first)&&Number.isInteger(i.rows)&&(s=s.range(i.first,i.first+i.rows-1))}}}}]);